"type": "record",
  "name": "Incident",
  "fields": [
    { "name": "id", "type": "string" },
    { "name": "post_id", "type": ["null", "string"], "default": null },
    { "name": "update_time", "type": "long" },
    {
      "name": "channel", "type": {
        "type": "record",
        "name": "Channel",
        "fields": [
          { "name": "name", "type": "string" },
          { "name": "id", "type": ["null", "string"], "default": null }
        ]
      }
    },
    { "name": "original_content", "type": "string" },
    { "name": "summary", "type": "string" },
    { "name": "media_url", "type": ["null", "string"], "default": null },
    { "name": "source_language", "type": "string" },
    { "name": "title", "type": "string" },
    { "name": "type", "type": "string" },
    { "name": "city", "type": "string" },
    { "name": "place", "type": "string" },
    { "name": "involves", "type": ["null", "string"], "default": null },
    {
      "name": "casualties", "type": {
        "type": "record",
        "name": "Casualties",
        "fields": [
          {
            "name": "blue_side", "type": {
              "type": "record",
              "name": "Side",
              "fields": [
                { "name": "lightly_injured", "type": ["null", "string"], "default": null },
                { "name": "moderately_injured", "type": ["null", "string"], "default": null },
                { "name": "seriously_injured", "type": ["null", "string"], "default": null },
                { "name": "critical_injured", "type": ["null", "string"], "default": null },
                { "name": "deaths", "type": ["null", "string"], "default": null }
              ]
            }
          },
          {
            "name": "red_side", "type": "Side"
          }
        ]
      }
    },
    { "name": "source", "type": ["null", "string"], "default": null },
    { "name": "date", "type": ["null", "string"], "default": null },
    { "name": "time", "type": ["null", "string"], "default": null },
    { "name": "verification_status", "type": "string" },
    { "name": "incident_priority", "type": "string" },
    { "name": "tags", "type": "string" },
    {
      "name": "geo", "type": {
        "type": "record",
        "name": "Geo",
        "fields": [
          { "name": "regions", "type": ["null", "string"], "default": null },
          { "name": "locations", "type": ["null", "string"], "default": null },
          { "name": "source", "type": ["null", "string"], "default": null },
          { "name": "point_id", "type": ["null", "string"], "default": null },
          { "name": "geography", "type": ["null", "string"], "default": null },
          { "name": "neighborhood", "type": ["null", "string"], "default": null }
        ]
      }
    }
  ]



module "reciver_cloud_run" {
  source     = "../modules/cloud-run-v2"
  project_id = "sky3-star-mzp-ppd-d-eagleye-1"
  name       = "reciver-and-publisher"
  region     = "me-west1"
  ingress = "INGRESS_TRAFFIC_INTERNAL_ONLY"
  containers = {
    telegram = {
      image = "me-west1-docker.pkg.dev/sky3-star-mzp-ppd-d-eagleye-1/dmz/dmz-image:latest"
    }
  }
  revision = {
    gen2_execution_environment = true
    max_instance_count         = 20
    vpc_access = {
      egress = "PRIVATE_RANGES_ONLY"
      subnet = "projects/sky3-starfish-mzp-preprod-d-0/regions/me-west1/subnetworks/preprod-dmz-eagleye-1"
    }
  }
  deletion_protection = false
  service_account = module.cloud-run-service-account.email
}


{
  "time": "2025-03-02 11:59:09",
  "content": "חוזלעטו",
  "channel": "internal8104",
  "channel_id": 2371097149,
  "id": "4ad04f30-4c00-4f4a-a64e-d75b98c868eb",
  "update_time": 1740916752245,
  "is_blue_data": true
}

[
    { "name": "id", "type": "string" },
    { "name": "post_id", "type": ["null", "string"], "default": null },
    { "name": "update_time", "type": "long" },
    {
      "name": "channel", "type": {
        "type": "record",
        "name": "Channel",
        "fields": [
          { "name": "name", "type": "string" },
          { "name": "id", "type": ["null", "string"], "default": null }
        ]
      }
    },
    { "name": "is_breaking_news", "type": "boolean" },
    { "name": "is_breaking_news_scale", "type": "string" },
    { "name": "original_content", "type": "string" },
    { "name": "summary", "type": "string" },
    { "name": "media_url", "type": ["null", "string"], "default": null },
    { "name": "source_language", "type": "string" },
    { "name": "title", "type": "string" },
    { "name": "type", "type": ["null", "string"], "default": null },
    { "name": "city", "type": ["null", "string"], "default": null },
    { "name": "place", "type": ["null", "string"], "default": null },
    { "name": "involves", "type": ["null", "string"], "default": null },
    {
      "name": "casualties", "type": {
        "type": "record",
        "name": "Casualties",
        "fields": [
          {
            "name": "blue_side", "type": {
              "type": "record",
              "name": "Side",
              "fields": [
                { "name": "lightly_injured", "type": ["null", "string"], "default": null },
                { "name": "moderately_injured", "type": ["null", "string"], "default": null },
                { "name": "seriously_injured", "type": ["null", "string"], "default": null },
                { "name": "critical_injured", "type": ["null", "string"], "default": null },
                { "name": "deaths", "type": ["null", "string"], "default": null }
              ]
            }
          },
          {
            "name": "red_side", "type": "Side"
          }
        ]
      }
    },
    { "name": "source", "type": ["null", "string"], "default": null },
    { "name": "date", "type": ["null", "string"], "default": null },
    { "name": "time", "type": ["null", "string"], "default": null },
    { "name": "verification_status", "type": ["null", "string"], "default": null },
    { "name": "incident_priority", "type": ["null", "string"], "default": null },
    { "name": "tags", "type": ["null", "string"], "default": null },
    {
      "name": "geo", "type": {
        "type": "record",
        "name": "Geo",
        "fields": [
          { "name": "regions", "type": ["null", "string"], "default": null },
          { "name": "locations", "type": ["null", "string"], "default": null },
          { "name": "source", "type": ["null", "string"], "default": null },
          { "name": "point_id", "type": ["null", "string"], "default": null },
          { "name": "geography", "type": ["null", "string"], "default": null },
          { "name": "neighborhood", "type": ["null", "string"], "default": null }
        ]
      }
    }
  ]

{'id': 'test', 'post_id': None, 'update_time': 1740675555683, 'channel': {'name': 'test_channel', 'id': None}, 'is_breaking_news': False, 'is_breaking_news_scale': '0%', 'original_content': 'אירוע בדיקה - לא אמיתי, 3 פצועים קל, בשעה 7 וחצי בבוקר', 'summary': 'אירוע בדיקה (לא אמיתי) עם 3 פצועים קל בשעה 7:30 בבוקר.', 'media_url': None, 'source_language': 'hebrew', 'title': 'אירוע בדיקה', 'type': None, 'city': None, 'place': None, 'involves': None, 'casualties': {'blue_side': {'lightly_injured': '3', 'moderately_injured': None, 'seriously_injured': None, 'critical_injured': None, 'deaths': None}, 'red_side': {'lightly_injured': None, 'moderately_injured': None, 'seriously_injured': None, 'critical_injured': None, 'deaths': None}}, 'source': None, 'date': None, 'time': '7:30', 'verification_status': None, 'incident_priority': None, 'tags': None, 'geo': {'regions': None, 'locations': None, 'source': None, 'point_id': None, 'geography': None, 'neighborhood': None}}

ChatGPT said:
Main With Avro Schema
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
resource "google_pubsub_schema" "incident_schema" {
  name       = "incident-schema"
  type       = "AVRO"

  definition = <<EOT
{
  "type": "record",
  "name": "Incident",
  "fields": [
    { "name": "id", "type": "string" },
    { "name": "post_id", "type": ["null", "string"], "default": null },
    { "name": "update_time", "type": "long" },
    {
      "name": "channel", "type": {
        "type": "record",
        "name": "Channel",
        "fields": [
          { "name": "name", "type": "string" },
          { "name": "id", "type": ["null", "string"], "default": null }
        ]
      }
    },
    { "name": "is_breaking_news", "type": "boolean" },
    { "name": "is_breaking_news_scale", "type": "string" },
    { "name": "original_content", "type": "string" },
    { "name": "summary", "type": "string" },
    { "name": "media_url", "type": ["null", "string"], "default": null },
    { "name": "source_language", "type": "string" },
    { "name": "title", "type": "string" },
    { "name": "type", "type": ["null", "string"], "default": null },
    { "name": "city", "type": ["null", "string"], "default": null },
    { "name": "place", "type": ["null", "string"], "default": null },
    { "name": "involves", "type": ["null", "string"], "default": null },
    {
      "name": "casualties", "type": {
        "type": "record",
        "name": "Casualties",
        "fields": [
          {
            "name": "blue_side", "type": {
              "type": "record",
              "name": "Side",
              "fields": [
                { "name": "lightly_injured", "type": ["null", "string"], "default": null },
                { "name": "moderately_injured", "type": ["null", "string"], "default": null },
                { "name": "seriously_injured", "type": ["null", "string"], "default": null },
                { "name": "critical_injured", "type": ["null", "string"], "default": null },
                { "name": "deaths", "type": ["null", "string"], "default": null }
              ]
            }
          },
          {
            "name": "red_side", "type": "Side"
          }
        ]
      }
    },
    { "name": "source", "type": ["null", "string"], "default": null },
    { "name": "date", "type": ["null", "string"], "default": null },
    { "name": "time", "type": ["null", "string"], "default": null },
    { "name": "verification_status", "type": ["null", "string"], "default": null },
    { "name": "incident_priority", "type": ["null", "string"], "default": null },
    { "name": "tags", "type": ["null", "string"], "default": null },
    {
      "name": "geo", "type": {
        "type": "record",
        "name": "Geo",
        "fields": [
          { "name": "regions", "type": ["null", "string"], "default": null },
          { "name": "locations", "type": ["null", "string"], "default": null },
          { "name": "source", "type": ["null", "string"], "default": null },
          { "name": "point_id", "type": ["null", "string"], "default": null },
          { "name": "geography", "type": ["null", "string"], "default": null },
          { "name": "neighborhood", "type": ["null", "string"], "default": null }
        ]
      }
    }
  ]
}
EOT
}

{'id': 'test', 'post_id': None, 'update_time': 1740675555683, 'channel': {'name': 'test_channel', 'id': None}, 'is_breaking_news': False, 'is_breaking_news_scale': '0%', 'original_content': 'אירוע בדיקה - לא אמיתי, 3 פצועים קל, בשעה 7 וחצי בבוקר', 'summary': 'אירוע בדיקה (לא אמיתי) עם 3 פצועים קל בשעה 7:30 בבוקר.', 'media_url': None, 'source_language': 'hebrew', 'title': 'אירוע בדיקה', 'type': None, 'city': None, 'place': None, 'involves': None, 'casualties': {'blue_side': {'lightly_injured': '3', 'moderately_injured': None, 'seriously_injured': None, 'critical_injured': None, 'deaths': None}, 'red_side': {'lightly_injured': None, 'moderately_injured': None, 'seriously_injured': None, 'critical_injured': None, 'deaths': None}}, 'source': None, 'date': None, 'time': '7:30', 'verification_status': None, 'incident_priority': None, 'tags': None, 'geo': {'regions': None, 'locations': None, 'source': None, 'point_id': None, 'geography': None, 'neighborhood': None}}

ChatGPT said:
Main With Avro Schema
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
resource "google_pubsub_schema" "incident_schema" {
  name       = "incident-schema"
  type       = "AVRO"

  definition = <<EOT
{
  "type": "record",
  "name": "Incident",
  "fields": [
    { "name": "id", "type": "string" },
    { "name": "post_id", "type": ["null", "string"], "default": null },
    { "name": "update_time", "type": "long" },
    {
      "name": "channel", "type": {
        "type": "record",
        "name": "Channel",
        "fields": [
          { "name": "name", "type": "string" },
          { "name": "id", "type": ["null", "string"], "default": null }
        ]
      }
    },
    { "name": "is_breaking_news", "type": "boolean" },
    { "name": "is_breaking_news_scale", "type": "string" },
    { "name": "original_content", "type": "string" },
    { "name": "summary", "type": "string" },
    { "name": "media_url", "type": ["null", "string"], "default": null },
    { "name": "source_language", "type": "string" },
    { "name": "title", "type": "string" },
    { "name": "type", "type": ["null", "string"], "default": null },
    { "name": "city", "type": ["null", "string"], "default": null },
    { "name": "place", "type": ["null", "string"], "default": null },
    { "name": "involves", "type": ["null", "string"], "default": null },
    {
      "name": "casualties", "type": {
        "type": "record",
        "name": "Casualties",
        "fields": [
          {
            "name": "blue_side", "type": {
              "type": "record",
              "name": "Side",
              "fields": [
                { "name": "lightly_injured", "type": ["null", "string"], "default": null },
                { "name": "moderately_injured", "type": ["null", "string"], "default": null },
                { "name": "seriously_injured", "type": ["null", "string"], "default": null },
                { "name": "critical_injured", "type": ["null", "string"], "default": null },
                { "name": "deaths", "type": ["null", "string"], "default": null }
              ]
            }
          },
          {
            "name": "red_side", "type": "Side"
          }
        ]
      }
    },
    { "name": "source", "type": ["null", "string"], "default": null },
    { "name": "date", "type": ["null", "string"], "default": null },
    { "name": "time", "type": ["null", "string"], "default": null },
    { "name": "verification_status", "type": ["null", "string"], "default": null },
    { "name": "incident_priority", "type": ["null", "string"], "default": null },
    { "name": "tags", "type": ["null", "string"], "default": null },
    {
      "name": "geo", "type": {
        "type": "record",
        "name": "Geo",
        "fields": [
          { "name": "regions", "type": ["null", "string"], "default": null },
          { "name": "locations", "type": ["null", "string"], "default": null },
          { "name": "source", "type": ["null", "string"], "default": null },
          { "name": "point_id", "type": ["null", "string"], "default": null },
          { "name": "geography", "type": ["null", "string"], "default": null },
          { "name": "neighborhood", "type": ["null", "string"], "default": null }
        ]
      }
    }
  ]
}
EOT
}

{'id': 'test', 'post_id': None, 'update_time': 1740675555683, 'channel': {'name': 'test_channel', 'id': None}, 'is_breaking_news': False, 'is_breaking_news_scale': '0%', 'original_content': 'אירוע בדיקה - לא אמיתי, 3 פצועים קל, בשעה 7 וחצי בבוקר', 'summary': 'אירוע בדיקה (לא אמיתי) עם 3 פצועים קל בשעה 7:30 בבוקר.', 'media_url': None, 'source_language': 'hebrew', 'title': 'אירוע בדיקה', 'type': None, 'city': None, 'place': None, 'involves': None, 'casualties': {'blue_side': {'lightly_injured': '3', 'moderately_injured': None, 'seriously_injured': None, 'critical_injured': None, 'deaths': None}, 'red_side': {'lightly_injured': None, 'moderately_injured': None, 'seriously_injured': None, 'critical_injured': None, 'deaths': None}}, 'source': None, 'date': None, 'time': '7:30', 'verification_status': None, 'incident_priority': None, 'tags': None, 'geo': {'regions': None, 'locations': None, 'source': None, 'point_id': None, 'geography': None, 'neighborhood': None}}

[
        { "name": "id", "type": "string" },
        { "name": "post_id", "type": ["null", "string"], "default": null },
        { "name": "update_time", "type": "long" },
        {
          "name": "channel", "type": {
            "type": "record",
            "name": "Channel",
            "fields": [
              { "name": "name", "type": "string" },
              { "name": "id", "type": ["null", "string"], "default": null }
            ]
          }
        },
        { "name": "original_content", "type": "string" },
        { "name": "summary", "type": "string" },
        { "name": "media_url", "type": ["null", "string"], "default": null },
        { "name": "source_language", "type": "string" },
        { "name": "title", "type": "string" },
        { "name": "type", "type": "string" },
        { "name": "city", "type": "string" },
        { "name": "place", "type": "string" },
        { "name": "involves", "type": ["null", "string"], "default": null },
        {
          "name": "casualties", "type": {
            "type": "record",
            "name": "Casualties",
            "fields": [
              {
                "name": "blue_side", "type": {
                  "type": "record",
                  "name": "Side",
                  "fields": [
                    { "name": "lightly_injured", "type": ["null", "string"], "default": null },
                    { "name": "moderately_injured", "type": ["null", "string"], "default": null },
                    { "name": "seriously_injured", "type": ["null", "string"], "default": null },
                    { "name": "critical_injured", "type": ["null", "string"], "default": null },
                    { "name": "deaths", "type": ["null", "string"], "default": null }
                  ]
                }
              },
              {
                "name": "red_side", "type": "Side"
              }
            ]
          }
        },
        { "name": "source", "type": ["null", "string"], "default": null },
        { "name": "date", "type": ["null", "string"], "default": null },
        { "name": "time", "type": ["null", "string"], "default": null },
        { "name": "verification_status", "type": "string" },
        { "name": "incident_priority", "type": "string" },
        { "name": "tags", "type": "string" },
        {
          "name": "geo", "type": {
            "type": "record",
            "name": "Geo",
            "fields": [
              { "name": "regions", "type": ["null", "string"], "default": null },
              { "name": "locations", "type": ["null", "string"], "default": null },
              { "name": "source", "type": ["null", "string"], "default": null },
              { "name": "point_id", "type": ["null", "string"], "default": null },
              { "name": "geography", "type": ["null", "string"], "default": null },
              { "name": "neighborhood", "type": ["null", "string"], "default": null }
            ]
          }
        }
      ]

================================================

[
    { "name": "id", "type": "string" },
    { "name": "post_id", "type": ["null", "string"], "default": null },
    { "name": "update_time", "type": "long" },
    { "name": "is_breaking_news", "type": "boolean" },
    { "name": "is_breaking_news_scale", "type": "string" },
    {
      "name": "channel",
      "type": {
        "type": "record",
        "name": "Channel",
        "fields": [
          { "name": "name", "type": "string" },
          { "name": "id", "type": ["null", "string"], "default": null }
        ]
      }
    },
    { "name": "original_content", "type": "string" },
    { "name": "summary", "type": "string" },
    { "name": "media_url", "type": ["null", "string"], "default": null },
    { "name": "source_language", "type": "string" },
    { "name": "title", "type": "string" },
    { "name": "type", "type": ["null", "string"], "default": null },
    { "name": "city", "type": ["null", "string"], "default": null },
    { "name": "place", "type": ["null", "string"], "default": null },
    { "name": "involves", "type": ["null", "string"], "default": null },
    {
      "name": "casualties",
      "type": {
        "type": "record",
        "name": "Casualties",
        "fields": [
          {
            "name": "blue_side",
            "type": {
              "type": "record",
              "name": "Side",
              "fields": [
                { "name": "lightly_injured", "type": ["null", "string"], "default": null },
                { "name": "moderately_injured", "type": ["null", "string"], "default": null },
                { "name": "seriously_injured", "type": ["null", "string"], "default": null },
                { "name": "critical_injured", "type": ["null", "string"], "default": null },
                { "name": "deaths", "type": ["null", "string"], "default": null }
              ]
            }
          },
          {
            "name": "red_side",
            "type": "Side"
          }
        ]
      }
    },
    { "name": "source", "type": ["null", "string"], "default": null },
    { "name": "date", "type": ["null", "string"], "default": null },
    { "name": "time", "type": ["null", "string"], "default": null },
    { "name": "verification_status", "type": ["null", "string"], "default": null },
    { "name": "incident_priority", "type": ["null", "string"], "default": null },
    { "name": "tags", "type": ["null", "string"], "default": null },
    {
      "name": "geo",
      "type": {
        "type": "record",
        "name": "Geo",
        "fields": [
          { "name": "regions", "type": ["null", "string"], "default": null },
          { "name": "locations", "type": ["null", "string"], "default": null },
          { "name": "source", "type": ["null", "string"], "default": null },
          { "name": "point_id", "type": ["null", "string"], "default": null },
          { "name": "geography", "type": ["null", "string"], "default": null },
          { "name": "neighborhood", "type": ["null", "string"], "default": null }
        ]
      }
    }
  ]


{
  "id": "181346ab-f0f3-461c-a6fe-cfaef4912568",
  "post_id": null,
  "update_time": 1740991351779,
  "channel": {
    "name": "internal8104",
    "id": 2371097149
  },
  "is_breaking_news": false,
  "is_breaking_news_scale": "0%",
  "original_content": "לגלגל",
  "summary": null,
  "media_url": null,
  "source_language": "hebrew",
  "title": "לגלגל",
  "type": null,
  "city": null,
  "place": null,
  "involves": null,
  "casualties": {
    "blue_side": {
      "lightly_injured": null,
      "moderately_injured": null,
      "seriously_injured": null,
      "critical_injured": null,
      "deaths": null
    },
    "red_side": {
      "lightly_injured": null,
      "moderately_injured": null,
      "seriously_injured": null,
      "critical_injured": null,
      "deaths": null
    }
  },
  "source": null,
  "date": null,
  "time": null,
  "verification_status": null,
  "incident_priority": null,
  "tags": null,
  "geo": {
    "regions": null,
    "locations": null,
    "source": null,
    "point_id": null,
    "geography": null,
    "neighborhood": null
  }
}
