locals {
  events_after_llm = jsonencode([
    { name = "id", type = "STRING" },
    { name = "post_id", type = "STRING", mode = "NULLABLE" },
    { name = "update_time", type = "INT64" },
    { name = "channel", type = "STRUCT", fields = [
      { name = "name", type = "STRING" },
      { name = "id", type = "INT64" }
    ] },
    { name = "is_breaking_news", type = "BOOLEAN" },
    { name = "is_breaking_news_scale", type = "STRING" },
    { name = "original_content", type = "STRING" },
    { name = "summary", type = "STRING", mode = "NULLABLE" },
    { name = "media_url", type = "STRING", mode = "NULLABLE" },
    { name = "source_language", type = "STRING" },
    { name = "title", type = "STRING" },
    { name = "type", type = "STRING", mode = "NULLABLE" },
    { name = "city", type = "STRING", mode = "NULLABLE" },
    { name = "place", type = "STRING", mode = "NULLABLE" },
    { name = "involves", type = "STRING", mode = "NULLABLE" },
    { name = "casualties", type = "STRUCT", fields = [
      { name = "blue_side", type = "STRUCT", fields = [
        { name = "lightly_injured", type = "STRING", mode = "NULLABLE" },
        { name = "moderately_injured", type = "STRING", mode = "NULLABLE" },
        { name = "seriously_injured", type = "STRING", mode = "NULLABLE" },
        { name = "critical_injured", type = "STRING", mode = "NULLABLE" },
        { name = "deaths", type = "STRING", mode = "NULLABLE" }
      ] },
      { name = "red_side", type = "STRUCT", fields = [
        { name = "lightly_injured", type = "STRING", mode = "NULLABLE" },
        { name = "moderately_injured", type = "STRING", mode = "NULLABLE" },
        { name = "seriously_injured", type = "STRING", mode = "NULLABLE" },
        { name = "critical_injured", type = "STRING", mode = "NULLABLE" },
        { name = "deaths", type = "STRING", mode = "NULLABLE" }
      ] }
    ] },
    { name = "source", type = "STRING", mode = "NULLABLE" },
    { name = "date", type = "STRING", mode = "NULLABLE" },
    { name = "time", type = "STRING", mode = "NULLABLE" },
    { name = "verification_status", type = "STRING", mode = "NULLABLE" },
    { name = "incident_priority", type = "STRING", mode = "NULLABLE" },
    { name = "tags", type = "STRING", mode = "NULLABLE" },
    { name = "geo", type = "STRUCT", fields = [
      { name = "regions", type = "STRING", mode = "NULLABLE" },
      { name = "locations", type = "STRING", mode = "NULLABLE" },
      { name = "source", type = "STRING", mode = "NULLABLE" },
      { name = "point_id", type = "STRING", mode = "NULLABLE" },
      { name = "geography", type = "STRING", mode = "NULLABLE" },
      { name = "neighborhood", type = "STRING", mode = "NULLABLE" }
    ] }
  ])
}


locals {
  events_after_llm = jsonencode([
    { name = "id", type = "STRING" },
    { name = "post_id", type = "STRING", mode = "NULLABLE" },
    { name = "update_time", type = "INT64" },
    { name = "channel", type = "STRUCT", fields = [
      { name = "name", type = "STRING" },
      { name = "id", type = "INT64" }
    ] },
    { name = "is_breaking_news", type = "BOOLEAN" },
    { name = "is_breaking_news_scale", type = "STRING" },
    { name = "original_content", type = "STRING" },
    { name = "summary", type = "STRING", mode = "NULLABLE" },
    { name = "media_url", type = "STRING", mode = "NULLABLE" },
    { name = "source_language", type = "STRING" },
    { name = "title", type = "STRING" },
    { name = "type", type = "STRING", mode = "NULLABLE" },
    { name = "city", type = "STRING", mode = "NULLABLE" },
    { name = "place", type = "STRING", mode = "NULLABLE" },
    { name = "involves", type = "STRING", mode = "NULLABLE" },
    { name = "casualties", type = "STRUCT", fields = [
      { name = "blue_side", type = "STRUCT", fields = [
        { name = "lightly_injured", type = "STRING", mode = "NULLABLE" },
        { name = "moderately_injured", type = "STRING", mode = "NULLABLE" },
        { name = "seriously_injured", type = "STRING", mode = "NULLABLE" },
        { name = "critical_injured", type = "STRING", mode = "NULLABLE" },
        { name = "deaths", type = "STRING", mode = "NULLABLE" }
      ] },
      { name = "red_side", type = "STRUCT", fields = [
        { name = "lightly_injured", type = "STRING", mode = "NULLABLE" },
        { name = "moderately_injured", type = "STRING", mode = "NULLABLE" },
        { name = "seriously_injured", type = "STRING", mode = "NULLABLE" },
        { name = "critical_injured", type = "STRING", mode = "NULLABLE" },
        { name = "deaths", type = "STRING", mode = "NULLABLE" }
      ] }
    ] },
    { name = "source", type = "STRING", mode = "NULLABLE" },
    { name = "date", type = "STRING", mode = "NULLABLE" },
    { name = "time", type = "STRING", mode = "NULLABLE" },
    { name = "verification_status", type = "STRING", mode = "NULLABLE" },
    { name = "incident_priority", type = "STRING", mode = "NULLABLE" },
    { name = "tags", type = "STRING", mode = "NULLABLE" },
    { name = "geo", type = "STRUCT", fields = [
      { name = "regions", type = "STRING", mode = "NULLABLE" },
      { name = "locations", type = "STRING", mode = "NULLABLE" },
      { name = "source", type = "STRING", mode = "NULLABLE" },
      { name = "point_id", type = "STRING", mode = "NULLABLE" },
      { name = "geography", type = "STRING", mode = "NULLABLE" },
      { name = "neighborhood", type = "STRING", mode = "NULLABLE" }
    ] }
  ])
}

 gcloud run services update eagleye-preprod-cr --image='me-west1-docker.pkg.dev/sky3-star-mzp-ppd-t-eagleye-1/to-on-prem/to-on-prem-image:latest' --update-env-vars=ONPREM_UR
L =https://eagleye-prep.private.sky320.com/api/v1/push/oVpdAsoJwGI,PROJECT_ID=sky3-starfish-mzp-preprod-i-0 --pro
ject='sky3-starfish-mzp-prod-i-0'

gcloud run services update eagleye-preprod-cr --image='me-west1-docker.pkg.dev/sky3-star-mzp-ppd-t-eagleye-1/to-on-prem/to-on-prem-image:latest' --update-env-vars=url=https://nahaeer,ENV=preprod,DEBUG=false --project='sky3-starfish-mzp-prod-i-0'

gcloud run services update eagleye-preprod-cr --image='me-west1-docker.pkg.dev/sky3-star-mzp-ppd-t-eagleye-1/to-on-prem/to-on-prem-image:latest' --project='sky3-starfish-mzp-prod-i-0'

options:
  logging: CLOUD_LOGGING_ONLY
  pool:
    name: projects/sky3-starfish-mzp-d-cicd-0/locations/me-west1/workerPools/cicd-worker-pool

steps:

  - name: 'gcr.io/cloud-builders/docker'
    args: ['pull', 'me-west1-docker.pkg.dev/sky-starfish-mzp-cicd-ar-0/mzp-dmz-artifact-registry/dmz:latest']

  - name: 'gcr.io/cloud-builders/docker'
    args: ['tag', 'me-west1-docker.pkg.dev/sky-starfish-mzp-cicd-ar-0/mzp-dmz-artifact-registry/dmz:latest', 'me-west1-docker.pkg.dev/sky3-star-mzp-ppd-d-eagleye-1/dmz/dmz-image:latest']
  
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', 'me-west1-docker.pkg.dev/sky3-star-mzp-ppd-d-eagleye-1/dmz/dmz-image:latest']

  - name: 'gcr.io/cloud-builders/docker'
    args: ['tag', 'me-west1-docker.pkg.dev/sky3-star-mzp-ppd-d-eagleye-1/dmz/dmz-image:latest', 'me-west1-docker.pkg.dev/sky3-star-mzp-prd-d-eagleye-1/dmz/dmz-image:latest']
  
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', 'me-west1-docker.pkg.dev/sky3-star-mzp-prd-d-eagleye-1/dmz/dmz-image:latest']

  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
    entrypoint: gcloud
    args:
      - run
      - deploy
      - dmz-service-name
      - --image=me-west1-docker.pkg.dev/sky3-star-mzp-prd-d-eagleye-1/dmz/dmz-image:latest
      - --region=me-west1
      - --platform=managed
      - --allow-unauthenticated
      - --quiet
